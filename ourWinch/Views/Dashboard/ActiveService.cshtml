@using ourWinch.Models.Dashboard;
@model IEnumerable<ServiceOrder>

@{
    var currentController = ViewContext.RouteData.Values["controller"].ToString();
    var currentAction = ViewContext.RouteData.Values["action"].ToString();
}
<style>
    .pagination-link {
        display: inline-block;
        width: 30px;
        height: 30px;
        line-height: 30px;
        text-align: center;
        border: 1px solid #000;
        border-radius: 50%;
        margin: 5px;
        text-decoration: none;
        color: #000;
        transition: background-color 0.4s;
    }

        .pagination-link:hover {
            background-color: white;
        }
</style>
                      <div class="container mt-4">
                          <div class="heading" style="background-color: #C0D0D7; border-radius: 10px; display: block; padding: 10px 30px; text-align: center; font-weight: bold; font-size: 32px; margin: 10px auto; width: fit-content;">Aktive Servicer</div>

                          <div class="table-responsive">

                              @if (Model != null && Model.Any())

             {
                              <table class="table table-bordered">
                                  <thead style="background-color: #B9B9B9;">
                                      <tr>
                                          <th style="border: 2px solid #000;">OrderID</th>
                                          <th style="border: 2px solid #000;">Product Type</th>
                                          <th style="border: 2px solid #000;">Kunde</th>
                                          <th style="border: 2px solid #000;">Mottatt Dato</th>
                                          <th style="border: 2px solid #000;">Feilbeskriving</th>
                                          <th style="border: 2px solid #000;">Avtalt Levering</th>
                                          <th style="border: 2px solid #000;">Status</th>
                                          <th style="border: 2px solid #000;">Service Skjema</th>
                                          <th style="border: 2px solid #000;">Timer</th>
                                      </tr>
                                  </thead>
                                  <tbody>
                                      @foreach (var item in Model)
                            {
                                      <tr>
                            <td>
                                <div class="dropdown">
                                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">@item.Ordrenummer</a>
                                    <div class="dropdown-menu">
                                        <a class="dropdown-item @(currentController == "Mechanical" && currentAction == "Create" ? "active-link" : "")"
                                           asp-controller="Mechanical" asp-action="Create" asp-route-id="@item.ServiceOrderId">Mechanical</a>
                                        <a class="dropdown-item @(currentController == "Hydrolisk" && currentAction == "Create" ? "active-link" : "")"
                                           asp-controller="Hydrolisk" asp-action="Create" asp-route-id="@item.ServiceOrderId">Hydrolisk</a>
                                        <a class="dropdown-item @(currentController == "Electro" && currentAction == "Create" ? "active-link" : "")"
                                           asp-controller="Electro" asp-action="Create" asp-route-id="@item.ServiceOrderId">Electro</a>
                                        <a class="dropdown-item @(currentController == "FunksjonsTest" && currentAction == "Create" ? "active-link" : "")"
                                           asp-controller="FunksjonsTest" asp-action="Create" asp-route-id="@item.ServiceOrderId">FunksjonsTest</a>
                                        <a class="dropdown-item @(currentController == "Trykk" && currentAction == "Create" ? "active-link" : "")"
                                           asp-controller="Trykk" asp-action="Create" asp-route-id="@item.ServiceOrderId">Trykk</a>
                                    </div>
                                </div>
                            </td>


                                          <td>@item.Produkttype</td>
                                          <td>@item.Fornavn @item.Etternavn</td>
                                          <td>@item.MottattDato.ToShortDateString()</td>
                                          <td>@item.Feilbeskrivelse</td>
                                          <td>@(item.MottattDato != null ? item.MottattDato.ToShortDateString() : "N/A")</td>
                                          <td>Process</td>
                            <td>
                                @if (@item.ServiceSkjema == "Ja")
                                {
                                    <a href="@Url.Action("Index", "ServiceSkjema")">@item.ServiceSkjema</a>
                                }
                                else
                                {
                                    @item.ServiceSkjema
                                }
                            </td>
                                          <td>4</td> <!-- Timer kısmı boş bırakıldı. -->
                                      </tr>
                                           }
                                  </tbody>
                              </table>
                              }
                              else
                              {
                              <p>No service orders available.</p>
                              }
    </div>

    <div>
        Current Page: @((ViewBag.CurrentPage as int?) ?? 1)
        Total Pages: @((ViewBag.TotalPages as int?) ?? 1)
    </div>


    @if (ViewBag.CurrentPage != null && ViewBag.TotalPages != null)
    {
        <div class="pagination-container">
            @try
            {
                int currentPage = (int)ViewBag.CurrentPage;
                int totalPages = (int)ViewBag.TotalPages;

                if (totalPages > 0 && currentPage > 0)
                {
                    for (var i = 1; i <= totalPages; i++)
                    {
                        <a class="pagination-link @(currentPage == i ? "active-page" : "")" asp-controller="Dashboard" asp-action="ActiveService" asp-route-page="@i"
                           style="background-color: @(currentPage == i ? "#3498db" : "#B9B9B9");">@i</a>
                    }
                }
                else
                {
                    <div style="color:red;">It is error.</div>
                }
            }
            catch (Exception ex)
            {
                <div style="color:red;">Error: @ex.Message</div>
            }
        </div>
    }

</div>